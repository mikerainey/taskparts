{
    "$schema": "http://json-schema.org/draft-07/schema#",

    "$defs": {
	"row": {
	    "type": "array",
	    "items": {
		"type": "object",
		"properties": {
		    "key": { "type": "string" },
		    "val": { "val": { "type": "object",
				      "oneOf": [{"type": "string"},
						{"type": "number"}]}
			   }
		},
		"uniqueKeys": ["/key"],
		"required": ["key", "val"]
            }
	},
	
	"expr-value": {
            "type": "object",
            "properties": {
		"value": {
		    "type": "array",
		    "items": {
			"$ref": "#/$defs/row" 
		    }
		}
            },
            "required": ["value"]
	},
        
        "expr-append": {
            "type": "object",
            "properties": {
		"append": {
		    "type": "object",
                    "properties": {
			"e1":{"$ref": "#/$defs/expr" },
                        "e2":{"$ref": "#/$defs/expr" }
                    },
                    "required": ["e1", "e2"]
		}
            },
            "required": ["append"]
        },

	"expr-cross": {
            "type": "object",
            "properties": {
		"cross": {
		    "type": "object",
                    "properties": {
			"e1":{"$ref": "#/$defs/expr" },
                        "e2":{"$ref": "#/$defs/expr" }
                    },
                    "required": ["e1", "e2"]
		}
            },
            "required": ["cross"]
        },

	"expr-take_kvp": {
            "type": "object",
            "properties": {
		"take_kvp": {
		    "type": "object",
                    "properties": {
			"e1":{"$ref": "#/$defs/expr" },
                        "e2":{"$ref": "#/$defs/expr" }
                    },
                    "required": ["e1", "e2"]
		}
            },
            "required": ["take_kvp"]
        },

	"expr-drop_kvp": {
            "type": "object",
            "properties": {
		"drop_kvp": {
		    "type": "object",
                    "properties": {
			"e1":{"$ref": "#/$defs/expr" },
                        "e2":{"$ref": "#/$defs/expr" }
                    },
                    "required": ["e1", "e2"]
		}
            },
            "required": ["drop_kvp"]
        },

	"expr-take_k": {
            "type": "object",
            "properties": {
		"take_k": {
		    "type": "object",
                    "properties": {
			"e1":{"$ref": "#/$defs/expr" },
                        "e2":{"$ref": "#/$defs/expr" }

                    },
                    "required": ["e1", "e2"]
		}
            },
            "required": ["take_k"]
        },

	"expr-drop_k": {
            "type": "object",
            "properties": {
		"drop_k": {
		    "type": "object",
                    "properties": {
			"e1":{"$ref": "#/$defs/expr" },
                        "e2":{"$ref": "#/$defs/expr" }

                    },
                    "required": ["e1", "e2"]
		}
            },
            "required": ["drop_k"]
        },

	"expr": {
            "oneOf": [
		{"$ref": "#/$defs/expr-value" },
		{"$ref": "#/$defs/expr-append"},
		{"$ref": "#/$defs/expr-cross"},
		{"$ref": "#/$defs/expr-take_kvp"},
		{"$ref": "#/$defs/expr-drop_kvp"},
		{"$ref": "#/$defs/expr-take_k"},
		{"$ref": "#/$defs/expr-drop_k"}
            ]
	}
    },
    
    "$ref": "#/$defs/expr" 
}
